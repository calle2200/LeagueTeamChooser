<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>League Lag</title>
  <style>
    body {
      font-family: sans-serif;
      background: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    .hidden {
      display: none !important;
    }

    .setup {
      margin-bottom: 30px;
      text-align: center;
    }

    .player-list label {
      display: block;
      margin: 5px 0;
    }

    .teams {
      display: flex;
      justify-content: space-between;
      width: 80%;
      margin-bottom: 20px;
    }

    .team {
      border: 2px solid white;
      padding: 10px;
      border-radius: 10px;
      width: 30%;
      height: 500px;
      overflow-y: auto;
    }

    .team h3 {
      text-align: center;
      margin-bottom: 10px;
    }

    .carousel-container {
      overflow: hidden;
      width: 300px;
      height: 100px;
      border: 3px solid #fff;
      margin: 20px 0;
      position: relative;
    }

    .carousel {
      display: flex;
      transition: transform 3s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .item {
      width: 100px;
      height: 100px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      color: #fff;
    }

    .item img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-bottom: 5px;
      border: 2px solid #fff;
    }

    .indicator {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 0;
      left: 50%;
      transform: translateX(-50%);
      border-left: 3px solid red;
      z-index: 2;
    }

    .btn {
      padding: 10px 20px;
      background: #2196f3;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 10px;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 30px;
      border: 2px solid #fff;
      border-radius: 10px;
      font-size: 24px;
      display: none;
      z-index: 10;
    }

    .team-player {
      display: flex;
      align-items: center;
      margin: 10px 0;
      font-size: 18px;
    }

    .team-player img.player-img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 10px;
      border: 2px solid #fff;
    }

    .team-player img.role-img {
      width: 30px;
      height: 30px;
      margin-left: 10px;
    }
  </style>
</head>

<body>

  <!-- Setup View -->
  <div class="setup" id="setup">
    <h2>VÃ¤lj 10 spelare att vara med</h2>
    <p>Valda spelare: <span id="selectedCount">0</span>/10</p>
    <div class="player-list" id="playerList"></div>
    <button class="btn" onclick="startGame()">Starta Rullbandet</button>
    <p id="error" style="color: red;"></p>
  </div>

  <!-- Main Game View -->
  <div class="teams hidden" id="gameSection">
    <div class="team" id="team1">
      <h3>Lag 1</h3>
    </div>
    <div class="team" id="team2">
      <h3>Lag 2</h3>
    </div>
  </div>

  <div class="carousel-container hidden" id="carouselContainer">
    <div class="indicator"></div>
    <div class="carousel" id="carousel"></div>
  </div>

  <button class="btn hidden" id="rollBtn" onclick="roll()">Snurra!</button>
  <div class="popup" id="popup"></div>

  <script>
    const allPlayers = [
      { name: "FatNeek", img: "alistar.jpg" },
      { name: "Dedona", img: "icon.png" },
      { name: "Stahlet", img: "ezreal.png" },
      { name: "Simpa", img: "sylas.webp" },
      { name: "LolSpelare", img: "yone.jpg" },
      { name: "Skalander", img: "voli.jpg" },
      { name: "Luigi", img: "sion.webp" },
      { name: "2Camel", img: "rammus.jpg" },
      { name: "Moses", img: "icon.png" },
      { name: "Pelle", img: "icon.png" },
      { name: "Rez", img: "icon.png" },
      { name: "Lampskaerm", img: "icon.png" },
      { name: "Daddyshooker", img: "icon.png" },
      { name: "Fnorkos", img: "icon.png" },
      { name: "Saedobity", img: "icon.png" },
      { name: "Guest1", img: "icon.png" },
      { name: "Guest2", img: "icon.png" },
      { name: "Guest3", img: "icon.png" },
      { name: "Guest4", img: "icon.png" },
      { name: "Guest5", img: "icon.png" }
    ];

    const roleImages = [
      { role: "toplane", img: "toplane.png" },
      { role: "jungle", img: "jungle.png" },
      { role: "midlane", img: "midlane.png" },
      { role: "botlane", img: "botlane.png" },
      { role: "support", img: "support.png" }
    ];

    const playerList = document.getElementById("playerList");
    const setupSection = document.getElementById("setup");
    const gameSection = document.getElementById("gameSection");
    const carouselContainer = document.getElementById("carouselContainer");
    const rollBtn = document.getElementById("rollBtn");
    const errorDisplay = document.getElementById("error");
    const selectedCountEl = document.getElementById("selectedCount");

    // Populate checkboxes
    allPlayers.forEach((player, index) => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" value="${index}" /> ${player.name}`;
      label.querySelector("input").addEventListener("change", updateSelectedCount);
      playerList.appendChild(label);
    });

    function updateSelectedCount() {
      const count = document.querySelectorAll("input[type='checkbox']:checked").length;
      selectedCountEl.textContent = count;
    }

    let availableItems = [];
    let round = 0;
    let usedRolesTeam1 = new Set();
    let usedRolesTeam2 = new Set();

    const carousel = document.getElementById("carousel");
    const popup = document.getElementById("popup");
    const team1 = document.getElementById("team1");
    const team2 = document.getElementById("team2");

    function getAvailableRole(usedRoles) {
      const available = roleImages.filter(r => !usedRoles.has(r.role));
      if (available.length === 0) return null;
      return available[Math.floor(Math.random() * available.length)];
    }

    function createPlayerElement(player) {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `<img src="${player.img}" alt="${player.name}" /><span>${player.name}</span>`;
      return el;
    }

    function renderCarousel() {
      carousel.innerHTML = "";
      for (let i = 0; i < 3 * availableItems.length; i++) {
        const player = availableItems[i % availableItems.length];
        const item = createPlayerElement(player);
        carousel.appendChild(item);
      }
    }

    function startGame() {
      const selected = [...document.querySelectorAll("input[type='checkbox']:checked")].map(cb => allPlayers[cb.value]);
      if (selected.length !== 10) {
        errorDisplay.textContent = "Du mÃ¥ste vÃ¤lja exakt 10 spelare!";
        return;
      }

      availableItems = selected;
      setupSection.classList.add("hidden");
      gameSection.classList.remove("hidden");
      carouselContainer.classList.remove("hidden");
      rollBtn.classList.remove("hidden");
      renderCarousel();
    }

    function roll() {
      if (availableItems.length === 0) {
        alert("Alla spelare har delats ut!");
        return;
      }

      const isSecondLastSpin = availableItems.length === 2;
      popup.style.display = "none";
      carousel.style.transition = "none";
      carousel.style.transform = `translateX(0px)`;

      setTimeout(() => {
        const itemWidth = 100;
        const itemsPerLoop = availableItems.length;
        const baseIndex = itemsPerLoop + Math.floor(Math.random() * itemsPerLoop);
        const offset = (baseIndex - 1) * itemWidth;

        carousel.style.transition = "transform 3s cubic-bezier(0.22, 1, 0.36, 1)";
        carousel.style.transform = `translateX(-${offset}px)`;

        setTimeout(() => {
          const selected = availableItems[baseIndex % itemsPerLoop];
          const currentTeam = round % 2 === 0 ? team1 : team2;
          const usedRoles = round % 2 === 0 ? usedRolesTeam1 : usedRolesTeam2;

          const role = getAvailableRole(usedRoles);
          usedRoles.add(role.role);

          const newDiv = document.createElement("div");
          newDiv.className = "team-player";
          newDiv.innerHTML = `
            <img src="${selected.img}" class="player-img" alt="${selected.name}">
            <span>${selected.name}</span>
            <img src="${role.img}" class="role-img" title="${role.role}">
            <span>${role.role}</span>
          `;
          currentTeam.appendChild(newDiv);

          let message = `ðŸŽ‰ ${selected.name} gÃ¥r till ${round % 2 === 0 ? "Lag 1" : "Lag 2"} som ${role.role}!`;
          availableItems = availableItems.filter(p => p.name !== selected.name);
          round++;

          if (isSecondLastSpin && availableItems.length === 1) {
            const remaining = availableItems[0];
            const otherTeam = round % 2 === 0 ? team1 : team2;
            const otherRoles = round % 2 === 0 ? usedRolesTeam1 : usedRolesTeam2;
            const autoRole = getAvailableRole(otherRoles);
            otherRoles.add(autoRole.role);

            const autoDiv = document.createElement("div");
            autoDiv.className = "team-player";
            autoDiv.innerHTML = `
              <img src="${remaining.img}" class="player-img" alt="${remaining.name}">
              <span>${remaining.name}</span>
              <img src="${autoRole.img}" class="role-img" title="${autoRole.role}">
              <span>${autoRole.role}</span>
            `;
            otherTeam.appendChild(autoDiv);

            message += `\nðŸª„ ${remaining.name} gÃ¥r automatiskt till ${round % 2 === 0 ? "Lag 1" : "Lag 2"} som ${autoRole.role}!`;
            availableItems = [];
            round++;
          }

          popup.textContent = message;
          popup.style.display = "block";
          renderCarousel();
        }, 3100);
      }, 50);
    }
  </script>
</body>

</html>
